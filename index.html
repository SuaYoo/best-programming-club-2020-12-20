<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Farmer's Market</title>
  </head>
  <body>
    <header>
      <h1>Farmer's Market</h1>
    </header>

    <main>
      <section id="products">
        <h2>Products</h2>

        <section class="product-sub-section">
          <h3>Available fruit</h3>
          <ul id="available-fruit-list"></ul>
        </section>

        <section class="product-sub-section">
          <h3>Available vegetables</h3>
          <ul id="available-vegetable-list"></ul>
        </section>
      </section>

      <section>
        <h2>Items in cart</h2>
        <p>There are <span id="cart-count">0</span> items in your cart.</p>
        <ul id="cart-list"></ul>

        <div>Total: $<span id="cart-total">0</span></div>
      </section>
    </main>

    <script>
      const availableProductsData = {
        fruit: [
          {
            product: 'Apple',
            price: '0.40',
          },
          {
            product: 'Banana',
            price: '0.20',
          },
        ],
        vegetables: [
          {
            product: 'Broccoli (per pound)',
            price: '0.80',
          },
          {
            product: 'Squash',
            price: '1.00',
          },
          {
            product: 'Carrot',
            price: '0.30',
          },
        ],
      }

      function initializeProducts() {
        function makeProductList(productData, listElementId) {
          const listElement = document.getElementById(listElementId)

          productData.forEach((itemData) => {
            const listItemElement = document.createElement('li')

            // The value for `innerText` that you see here is using what's called
            // "template literals". This syntax allows you to join multiple strings
            // together by embedding dynamic variables in a string.
            //
            // This is the same thing as doing:
            //   itemData.product + ' ($' + itemData.price + ')'
            // Try both ways!
            //
            // See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals
            listItemElement.innerText = `${itemData.product} ($${itemData.price})`

            listElement.appendChild(listItemElement)

            const buttonElement = document.createElement('button')

            buttonElement.classList.add('add-to-cart')
            buttonElement.dataset.product = itemData.product
            buttonElement.dataset.price = itemData.price
            buttonElement.innerText = 'Add +1 to cart'

            listItemElement.appendChild(buttonElement)
          })
        }

        // Make product list for fruit
        makeProductList(availableProductsData.fruit, 'available-fruit-list')
        makeProductList(
          availableProductsData.vegetables,
          'available-vegetable-list'
        )
      }

      function initializeCart() {
        const itemsInCart = []

        const cartListElement = document.getElementById('cart-list')

        // itemsInCart.forEach((item) => {
        // const cartListItem = document.createElement('li')
        // cartListItem.innerText = `${item.product} ($${item.price})`
        // cartListElement.appendChild(cartListItem)

        Array.from(document.querySelectorAll('.add-to-cart')).forEach(
          (button) => {
            button.addEventListener('click', () => {
              console.log('clicked add to cart')

              const itemsInCartCount = itemsInCart.length

              const latestCartItem = {
                product: button.dataset.product,
                price: Number(button.dataset.price),
              }

              // Checking if the button product is already in the itemsInCart
              for(var i = 0; i < itemsInCartCount; i++) {
                if (itemsInCart[i].product == latestCartItem.product) {
                  console.log('Already here!!!!!')
                  break
                }
              }

              itemsInCart.push({
                product: latestCartItem.product,
                price: latestCartItem.price,
              })

              let cartTotalOnClick = 0

              itemsInCart.forEach((item) => {
                cartTotalOnClick = cartTotalOnClick += item.price
              })

              document.getElementById('cart-count').innerText = itemsInCartCount

              document.getElementById(
                'cart-total'
              ).innerText = cartTotalOnClick.toFixed(2)

              console.log(itemsInCart)

              const cartListItemElement = document.createElement('li')
              cartListItemElement.innerText = `${latestCartItem.product} ($${latestCartItem.price})`
              cartListElement.appendChild(cartListItemElement)

              
              
            })
          }
        )
      }

      document.addEventListener('DOMContentLoaded', (event) => {
        console.log('DOM ready')

        initializeProducts()
        initializeCart()
      })
    </script>
  </body>
</html>
